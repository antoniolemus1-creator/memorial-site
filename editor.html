<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memorial Site Builder</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, 'Segoe UI', Arial, sans-serif; background: #f5f3ef; color: #333; line-height: 1.6; padding: 20px; }
    h1 { text-align: center; color: #2c2c3e; margin-bottom: 5px; font-size: 1.5rem; }
    .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
    .card { background: #fff; border-radius: 10px; padding: 25px; margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .card h2 { font-size: 1.1rem; color: #2c2c3e; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 8px; }
    label { display: block; font-weight: 600; margin: 12px 0 4px; font-size: 0.9rem; }
    input[type="text"], textarea { display: block; width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; font-family: inherit; }
    input[type="text"]:focus, textarea:focus { outline: none; border-color: #6c63a8; }
    textarea { min-height: 100px; resize: vertical; }
    select { display: block; width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; }
    input[type="file"] { display: block; width: 100%; padding: 10px; border: 2px dashed #ccc; border-radius: 6px; font-size: 0.95rem; background: #fafafa; margin-top: 4px; }
    .row { display: flex; gap: 12px; }
    .row > div { flex: 1; }
    .photo-list { margin-top: 8px; font-size: 0.9rem; color: #555; }
    .photo-item { padding: 5px 8px; background: #f5f3ef; border-radius: 4px; margin-bottom: 3px; display: flex; justify-content: space-between; align-items: center; }
    .photo-item button { background: #e44; color: #fff; border: none; border-radius: 4px; padding: 2px 10px; cursor: pointer; font-size: 0.85rem; }
    .portrait-preview { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd; margin-top: 8px; display: none; }
    .actions { text-align: center; max-width: 700px; margin: 25px auto; }
    .btn { padding: 14px 30px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 5px; }
    .btn-preview { background: #e8e6e1; color: #555; }
    .btn-download { background: #6c63a8; color: #fff; }
    .btn:active { transform: scale(0.97); }
    #status { text-align: center; max-width: 700px; margin: 10px auto; padding: 12px; border-radius: 8px; display: none; font-size: 0.95rem; }
    .hint { font-size: 0.8rem; color: #999; margin-top: 3px; }
    @media (max-width: 600px) { .row { flex-direction: column; gap: 0; } body { padding: 10px; } .card { padding: 15px; } }
</style>
</head>
<body>

<h1>Memorial Site Builder</h1>
<p class="subtitle">Fill in the details, upload photos & music, then download your site</p>

<!-- STEP 1 -->
<div class="card">
    <h2>1. Basic Information</h2>
    <label>Full Name</label>
    <input type="text" id="fullName" placeholder="e.g. John Michael Smith">
    <div class="row">
        <div><label>Date of Birth</label><input type="text" id="birthDate" placeholder="e.g. March 15, 1945"></div>
        <div><label>Date of Passing</label><input type="text" id="passDate" placeholder="e.g. February 20, 2026"></div>
    </div>
    <div class="row">
        <div><label>Age</label><input type="text" id="age" placeholder="e.g. 80"></div>
        <div><label>City, State</label><input type="text" id="cityState" placeholder="e.g. Cincinnati, Ohio"></div>
    </div>
    <label>Favorite Quote (optional)</label>
    <input type="text" id="epitaph" placeholder="e.g. Forever in our hearts">
    <label>Portrait Photo</label>
    <input type="file" id="portraitInput" accept="image/*">
    <img id="portraitPreview" class="portrait-preview">
</div>

<!-- STEP 2 -->
<div class="card">
    <h2>2. Obituary</h2>
    <label>Opening</label>
    <textarea id="obiIntro" placeholder="e.g. John Michael Smith, age 80, of Cincinnati, Ohio, passed away peacefully on February 20, 2026, surrounded by his loving family."></textarea>
    <label>Early Life</label>
    <textarea id="obiEarly" placeholder="e.g. He was born on March 15, 1945 in Columbus, Ohio to Robert and Mary Smith..."></textarea>
    <label>Life & Personality</label>
    <textarea id="obiLife" placeholder="e.g. John was known for his warm smile and generous spirit..."></textarea>
    <label>Career (optional)</label>
    <textarea id="obiCareer" placeholder="e.g. John dedicated 35 years to..."></textarea>
    <label>Survived By</label>
    <textarea id="obiFamily" placeholder="e.g. He is survived by his wife of 52 years, Margaret; his children..."></textarea>
    <label>Closing (optional)</label>
    <textarea id="obiClosing" placeholder="e.g. John will be deeply missed by all who knew him..."></textarea>
</div>

<!-- STEP 3 -->
<div class="card">
    <h2>3. Service Details</h2>
    <p class="hint">Leave blank to skip any section</p>
    <h3 style="margin-top:10px; font-size:0.95rem; color:#6c63a8;">Visitation</h3>
    <div class="row">
        <div><label>Date</label><input type="text" id="visDate" placeholder="e.g. Friday, Feb 22, 2026"></div>
        <div><label>Time</label><input type="text" id="visTime" placeholder="e.g. 4:00 PM - 8:00 PM"></div>
    </div>
    <label>Location</label>
    <input type="text" id="visLocation" placeholder="e.g. Smith Funeral Home, 123 Main St">

    <h3 style="margin-top:18px; font-size:0.95rem; color:#6c63a8;">Funeral Service</h3>
    <div class="row">
        <div><label>Date</label><input type="text" id="funDate" placeholder="e.g. Saturday, Feb 23, 2026"></div>
        <div><label>Time</label><input type="text" id="funTime" placeholder="e.g. 10:00 AM"></div>
    </div>
    <label>Location</label>
    <input type="text" id="funLocation" placeholder="e.g. St. Mary's Church, 456 Oak Ave">

    <h3 style="margin-top:18px; font-size:0.95rem; color:#6c63a8;">Burial</h3>
    <label>Location</label>
    <input type="text" id="burLocation" placeholder="e.g. Spring Grove Cemetery">
</div>

<!-- STEP 4 -->
<div class="card">
    <h2>4. Slideshow Photos</h2>
    <label>Select photos (you can pick multiple)</label>
    <input type="file" id="photosInput" accept="image/*" multiple>
    <div id="photoList" class="photo-list"></div>
    <label>Seconds per photo</label>
    <select id="slideDuration">
        <option value="5">5 seconds</option>
        <option value="8" selected>8 seconds (recommended)</option>
        <option value="10">10 seconds</option>
        <option value="12">12 seconds</option>
    </select>
</div>

<!-- STEP 5 -->
<div class="card">
    <h2>5. Background Music (optional)</h2>
    <label>Select an MP3 or audio file</label>
    <input type="file" id="musicInput" accept="audio/*">
    <p id="musicName" class="hint"></p>
</div>

<!-- BUTTONS -->
<div class="actions">
    <button class="btn btn-preview" onclick="doPreview()">Preview Obituary</button>
    <button class="btn btn-download" onclick="doDownload()">Download Site</button>
</div>
<div id="status"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
// ========== FILE HANDLING ==========
let portraitFile = null;
let photoFiles = [];
let musicFile = null;

// Portrait
document.getElementById('portraitInput').addEventListener('change', function() {
    if (this.files && this.files[0]) {
        portraitFile = this.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById('portraitPreview');
            img.src = e.target.result;
            img.style.display = 'block';
        };
        reader.readAsDataURL(portraitFile);
        showStatus('Portrait selected: ' + portraitFile.name, 'green');
    }
});

// Photos
document.getElementById('photosInput').addEventListener('change', function() {
    if (this.files) {
        for (let i = 0; i < this.files.length; i++) {
            photoFiles.push(this.files[i]);
        }
        renderPhotoList();
        showStatus(photoFiles.length + ' photo(s) total', 'green');
    }
});

function renderPhotoList() {
    const el = document.getElementById('photoList');
    if (photoFiles.length === 0) { el.innerHTML = ''; return; }
    el.innerHTML = photoFiles.map(function(f, i) {
        return '<div class="photo-item"><span>' + (i+1) + '. ' + f.name +
            ' (' + (f.size/1024/1024).toFixed(1) + ' MB)</span>' +
            '<button onclick="removePhoto(' + i + ')">X</button></div>';
    }).join('');
}

function removePhoto(i) {
    photoFiles.splice(i, 1);
    renderPhotoList();
}

// Music
document.getElementById('musicInput').addEventListener('change', function() {
    if (this.files && this.files[0]) {
        musicFile = this.files[0];
        document.getElementById('musicName').textContent = 'Selected: ' + musicFile.name;
        showStatus('Music selected: ' + musicFile.name, 'green');
    }
});

// ========== STATUS ==========
function showStatus(msg, color) {
    var el = document.getElementById('status');
    el.textContent = msg;
    el.style.display = 'block';
    el.style.background = color === 'green' ? '#efffef' : color === 'red' ? '#fff0f0' : '#f0f0ff';
    el.style.color = color === 'green' ? '#2a7a2a' : color === 'red' ? '#cc3333' : '#333';
}

// ========== READ FILE ==========
function readFile(file) {
    return new Promise(function(resolve, reject) {
        var reader = new FileReader();
        reader.onload = function() { resolve(reader.result); };
        reader.onerror = function() { reject(new Error('Failed to read ' + file.name)); };
        reader.readAsDataURL(file);
    });
}

// ========== GET FORM VALUES ==========
function getVal(id) { return document.getElementById(id).value; }

function getValues() {
    return {
        fullName: getVal('fullName') || '[FULL NAME]',
        birthDate: getVal('birthDate') || '[BIRTH DATE]',
        passDate: getVal('passDate') || '[PASSING DATE]',
        age: getVal('age') || '[AGE]',
        cityState: getVal('cityState') || '[CITY, STATE]',
        epitaph: getVal('epitaph'),
        obiIntro: getVal('obiIntro'),
        obiEarly: getVal('obiEarly'),
        obiLife: getVal('obiLife'),
        obiCareer: getVal('obiCareer'),
        obiFamily: getVal('obiFamily'),
        obiClosing: getVal('obiClosing'),
        visDate: getVal('visDate'),
        visTime: getVal('visTime'),
        visLocation: getVal('visLocation'),
        funDate: getVal('funDate'),
        funTime: getVal('funTime'),
        funLocation: getVal('funLocation'),
        burLocation: getVal('burLocation'),
        duration: getVal('slideDuration')
    };
}

// ========== ESCAPE HTML ==========
function esc(s) {
    var d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
}

// ========== BUILD OBITUARY ==========
function buildObituary(v, portraitB64) {
    var paras = [v.obiIntro, v.obiEarly, v.obiLife, v.obiCareer, v.obiFamily, v.obiClosing];
    var paraHTML = '';
    for (var i = 0; i < paras.length; i++) {
        if (paras[i] && paras[i].trim()) {
            paraHTML += '<p>' + esc(paras[i]) + '</p>\n';
        }
    }

    var portraitImg = portraitB64 ? '<img class="portrait" src="' + portraitB64 + '" alt="Portrait">' : '';
    var epitaphP = v.epitaph ? '<p class="epitaph">&ldquo;' + esc(v.epitaph) + '&rdquo;</p>' : '';

    var services = '';
    if (v.visDate || v.visTime || v.visLocation) {
        services += svcCard('Visitation', v.visDate, v.visTime, v.visLocation);
    }
    if (v.funDate || v.funTime || v.funLocation) {
        services += svcCard('Funeral Service', v.funDate, v.funTime, v.funLocation);
    }
    if (v.burLocation) {
        services += '<div class="service-card"><h3>Burial</h3>' +
            '<div class="detail"><span class="label">Location</span><span class="value">' + esc(v.burLocation) + '</span></div></div>';
    }

    return '<!DOCTYPE html>\n<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">' +
        '<title>In Loving Memory of ' + esc(v.fullName) + '</title>' +
        '<style>' +
        '*{margin:0;padding:0;box-sizing:border-box}' +
        'body{font-family:Georgia,serif;background:#1a1a2e;color:#e0d8cc;line-height:1.8}' +
        '.hero{text-align:center;padding:60px 20px 40px;background:linear-gradient(180deg,#0f0f1a,#1a1a2e)}' +
        '.hero .portrait{width:200px;height:200px;border-radius:50%;object-fit:cover;border:3px solid rgba(212,195,168,0.4);box-shadow:0 8px 30px rgba(0,0,0,0.5);margin-bottom:25px}' +
        '.hero h1{font-size:2.4rem;color:#fff;letter-spacing:3px;margin-bottom:8px;font-weight:400}' +
        '.hero .dates{font-size:1.15rem;color:rgba(212,195,168,0.7);letter-spacing:2px;margin-bottom:15px}' +
        '.hero .epitaph{font-style:italic;color:rgba(212,195,168,0.55);font-size:1.05rem;max-width:500px;margin:0 auto}' +
        'nav{text-align:center;padding:20px;background:rgba(0,0,0,0.25);border-top:1px solid rgba(212,195,168,0.1);border-bottom:1px solid rgba(212,195,168,0.1)}' +
        'nav a{color:#d4c3a8;text-decoration:none;margin:0 20px;font-size:1rem;letter-spacing:1.5px;text-transform:uppercase}nav a:hover{color:#fff}' +
        '.content{max-width:740px;margin:0 auto;padding:50px 25px 60px}' +
        '.section{margin-bottom:50px}' +
        '.section h2{font-size:1.4rem;color:#d4c3a8;letter-spacing:2px;text-transform:uppercase;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid rgba(212,195,168,0.2);font-weight:400}' +
        '.section p{margin-bottom:16px;font-size:1.05rem;color:rgba(224,216,204,0.85)}' +
        '.service-card{background:rgba(255,255,255,0.04);border:1px solid rgba(212,195,168,0.15);border-radius:8px;padding:30px;margin-bottom:16px}' +
        '.service-card h3{font-size:1.15rem;color:#d4c3a8;margin-bottom:12px;font-weight:400}' +
        '.service-card .detail{display:flex;margin-bottom:8px;font-size:1rem}' +
        '.service-card .label{width:100px;color:rgba(212,195,168,0.6);flex-shrink:0}' +
        '.service-card .value{color:#e0d8cc}' +
        '.slideshow-link{display:block;text-align:center;margin:40px auto;padding:18px 40px;background:rgba(212,195,168,0.1);border:1px solid rgba(212,195,168,0.3);border-radius:6px;color:#d4c3a8;text-decoration:none;font-size:1.1rem;letter-spacing:2px;text-transform:uppercase;max-width:360px}' +
        '.slideshow-link:hover{background:rgba(212,195,168,0.2);color:#fff}' +
        'footer{text-align:center;padding:30px 20px;color:rgba(212,195,168,0.3);font-size:0.85rem;border-top:1px solid rgba(212,195,168,0.08)}' +
        '@media(max-width:600px){.hero h1{font-size:1.8rem}.hero .portrait{width:150px;height:150px}.service-card .detail{flex-direction:column}.service-card .label{width:auto;margin-bottom:2px}}' +
        '</style></head><body>' +
        '<div class="hero">' + portraitImg +
        '<h1>' + esc(v.fullName) + '</h1>' +
        '<p class="dates">' + esc(v.birthDate) + ' &mdash; ' + esc(v.passDate) + '</p>' +
        epitaphP + '</div>' +
        '<nav><a href="#obituary">Obituary</a><a href="#services">Services</a><a href="slideshow.html">Photo Slideshow</a></nav>' +
        '<div class="content">' +
        '<div class="section" id="obituary"><h2>Obituary</h2>' + paraHTML + '</div>' +
        '<div class="section" id="services"><h2>Service Details</h2>' + services + '</div>' +
        '<a class="slideshow-link" href="slideshow.html">View Photo Slideshow</a>' +
        '</div>' +
        '<footer>In Loving Memory of ' + esc(v.fullName) + '</footer>' +
        '</body></html>';
}

function svcCard(title, date, time, loc) {
    var r = '<div class="service-card"><h3>' + esc(title) + '</h3>';
    if (date) r += '<div class="detail"><span class="label">Date</span><span class="value">' + esc(date) + '</span></div>';
    if (time) r += '<div class="detail"><span class="label">Time</span><span class="value">' + esc(time) + '</span></div>';
    if (loc) r += '<div class="detail"><span class="label">Location</span><span class="value">' + esc(loc) + '</span></div>';
    return r + '</div>';
}

// ========== BUILD SLIDESHOW ==========
function buildSlideshow(imgArray, musicB64, duration, title) {
    var imgJS = '';
    for (var i = 0; i < imgArray.length; i++) {
        imgJS += '"' + imgArray[i] + '"';
        if (i < imgArray.length - 1) imgJS += ',\n';
    }
    var audioTag = '';
    if (musicB64) {
        audioTag = '<audio id="bgmusic" loop autoplay><source src="' + musicB64 + '"></audio>';
    }
    return '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">' +
        '<title>' + esc(title) + '</title><style>' +
        '*{margin:0;padding:0;box-sizing:border-box}' +
        'body{background:#000;overflow:hidden;font-family:Georgia,serif;cursor:none}' +
        '#slideshow{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center}' +
        '.slide{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 1.5s ease-in-out}' +
        '.slide.active{opacity:1}' +
        '.slide img{max-width:92%;max-height:85vh;object-fit:contain;border-radius:4px;box-shadow:0 8px 40px rgba(0,0,0,0.6)}' +
        '#title-overlay{position:fixed;bottom:40px;left:0;right:0;text-align:center;color:rgba(255,255,255,0.75);font-size:1.6rem;letter-spacing:2px;text-shadow:0 2px 12px rgba(0,0,0,0.8);pointer-events:none;z-index:10}' +
        '#play-prompt{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;cursor:pointer}' +
        '#play-prompt h1{color:#fff;font-size:2rem;margin-bottom:20px;letter-spacing:2px}' +
        '#play-prompt p{color:rgba(255,255,255,0.6);font-size:1.1rem}' +
        '#counter{position:fixed;top:20px;right:25px;color:rgba(255,255,255,0.3);font-size:0.85rem;z-index:10;pointer-events:none}' +
        '</style></head><body>' +
        audioTag +
        '<div id="play-prompt" onclick="startShow()"><h1>' + esc(title) + '</h1><p>Click anywhere to begin</p></div>' +
        '<div id="slideshow"></div>' +
        '<div id="title-overlay">' + esc(title) + '</div>' +
        '<div id="counter"></div>' +
        '<script>' +
        'var DURATION=' + (duration*1000) + ';' +
        'var images=[' + imgJS + '];' +
        'var current=0,slides=[],timer=null;' +
        'var container=document.getElementById("slideshow");' +
        'for(var i=0;i<images.length;i++){' +
        'var div=document.createElement("div");div.className="slide"+(i===0?" active":"");' +
        'var img=document.createElement("img");img.src=images[i];' +
        'div.appendChild(img);container.appendChild(div);slides.push(div);}' +
        'function updateCounter(){document.getElementById("counter").textContent=(current+1)+" / "+slides.length;}' +
        'function nextSlide(){slides[current].classList.remove("active");current=(current+1)%slides.length;slides[current].classList.add("active");updateCounter();}' +
        'function startShow(){document.getElementById("play-prompt").style.display="none";' +
        'var a=document.getElementById("bgmusic");if(a)a.play().catch(function(){});' +
        'updateCounter();timer=setInterval(nextSlide,DURATION);}' +
        'var paused=false;' +
        'document.addEventListener("keydown",function(e){' +
        'if(e.code==="Space"){e.preventDefault();if(paused){timer=setInterval(nextSlide,DURATION);}else{clearInterval(timer);}paused=!paused;}' +
        'else if(e.code==="ArrowRight"){clearInterval(timer);nextSlide();if(!paused)timer=setInterval(nextSlide,DURATION);}' +
        'else if(e.code==="ArrowLeft"){clearInterval(timer);slides[current].classList.remove("active");current=(current-1+slides.length)%slides.length;slides[current].classList.add("active");updateCounter();if(!paused)timer=setInterval(nextSlide,DURATION);}' +
        'else if(e.code==="Escape"){document.body.style.cursor=document.body.style.cursor==="default"?"none":"default";}' +
        '});' +
        '<\/script></body></html>';
}

// ========== PREVIEW ==========
function doPreview() {
    showStatus('Building preview...', 'blue');
    var v = getValues();

    if (portraitFile) {
        readFile(portraitFile).then(function(data) {
            openPreview(buildObituary(v, data));
        }).catch(function(err) {
            showStatus('Error: ' + err.message, 'red');
        });
    } else {
        openPreview(buildObituary(v, null));
    }
}

function openPreview(html) {
    var blob = new Blob([html], {type: 'text/html'});
    var url = URL.createObjectURL(blob);
    // Try popup first, fall back to replacing current page
    var win = window.open(url, '_blank');
    if (!win) {
        // Popup blocked - use link click
        var a = document.createElement('a');
        a.href = url;
        a.target = '_blank';
        a.rel = 'noopener';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    showStatus('Preview opened in new tab!', 'green');
}

// ========== DOWNLOAD ==========
function doDownload() {
    if (typeof JSZip === 'undefined') {
        showStatus('Error: Could not load required library. Check internet connection and refresh.', 'red');
        return;
    }

    showStatus('Starting... reading files...', 'blue');
    var v = getValues();
    var zip = new JSZip();

    // Step 1: Read portrait
    var portraitPromise = portraitFile ? readFile(portraitFile) : Promise.resolve(null);

    portraitPromise.then(function(portraitB64) {
        showStatus('Building obituary page...', 'blue');
        zip.file('index.html', buildObituary(v, portraitB64));

        if (photoFiles.length === 0) {
            showStatus('No slideshow photos added. Downloading obituary only...', 'blue');
            return finishZip(zip, v.fullName);
        }

        // Step 2: Read all photos
        var photoPromises = [];
        for (var i = 0; i < photoFiles.length; i++) {
            photoPromises.push(readFile(photoFiles[i]));
        }

        return Promise.all(photoPromises).then(function(photoData) {
            showStatus('Processing photos done. Reading music...', 'blue');

            var musicPromise = musicFile ? readFile(musicFile) : Promise.resolve(null);
            return musicPromise.then(function(musicB64) {
                showStatus('Building slideshow...', 'blue');
                var title = 'In Loving Memory of ' + v.fullName;
                zip.file('slideshow.html', buildSlideshow(photoData, musicB64, parseInt(v.duration), title));
                return finishZip(zip, v.fullName);
            });
        });

    }).catch(function(err) {
        showStatus('Error: ' + err.message, 'red');
        console.error(err);
    });
}

function finishZip(zip, name) {
    showStatus('Creating zip file...', 'blue');
    return zip.generateAsync({type: 'blob'}).then(function(blob) {
        var safeName = name.replace(/[^a-zA-Z0-9 ]/g, '').replace(/\s+/g, '_');
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'memorial_' + safeName + '.zip';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        showStatus('Download complete! Send this zip file to your site host.', 'green');
    });
}

// ========== AUTO SAVE ==========
var fields = ['fullName','birthDate','passDate','age','cityState','epitaph',
    'obiIntro','obiEarly','obiLife','obiCareer','obiFamily','obiClosing',
    'visDate','visTime','visLocation','funDate','funTime','funLocation','burLocation','slideDuration'];

function autoSave() {
    var data = {};
    for (var i = 0; i < fields.length; i++) {
        data[fields[i]] = document.getElementById(fields[i]).value;
    }
    try { localStorage.setItem('memorial_data', JSON.stringify(data)); } catch(e) {}
}

function autoLoad() {
    try {
        var data = JSON.parse(localStorage.getItem('memorial_data'));
        if (!data) return;
        for (var key in data) {
            var el = document.getElementById(key);
            if (el && data[key]) el.value = data[key];
        }
    } catch(e) {}
}

autoLoad();
setInterval(autoSave, 5000);
</script>
</body>
</html>
